---
title: "Movie recommendation engine"
output: 
  html_document: 
    smart: no
---

https://github.com/jeknov/movieRec/blob/master/movieRec.R
https://muffynomster.wordpress.com/2015/06/07/building-a-movie-recommendation-engine-with-r/
https://www.analyticsvidhya.com/blog/2016/03/practical-guide-principal-component-analysis-python/


### Project details: 


#### Domain: Entertainment
#### Project: IMDB - Recommendation
#### Data: movie_metadata.csv

#### Description
- This dataset contains 28 variables for 5043 movies, spanning across 100 years in 66 countries. There are 2399 unique director names, and thousands of actors/actresses. Below are the 28 variables:

movie_title                                          
color                                                          
num_critic_for_reviews                                               
movie_facebook_likes                                                
duration                                                        
director_name                                                       
director_facebook_likes                                                       
actor_3_name                                                              
actor_3_facebook_likes                                                      
actor_2_name                                                                           
actor_2_facebook_likes                                                                
actor_1_name                                                                         
actor_1_facebook_likes                                                        
gross                                                                
genres                                                                       
num_voted_users                                                                  
cast_total_facebook_likes                                                            
facenumber_in_poster                                                                  
plot_keywords                                                                   
movie_imdb_link                                                                 
num_user_for_reviews                                                          
language                                                                  
country                                                                  
content_rating                                                               
budget                                                                                 
title_year                                                                      
imdb_score                                                                          
aspect_ratio                                                                

#### Objective
- Given that thousands of movies were produced each year, is there a better way for us to tell the greatness of movie without relying on critics or our own instincts? And try to create a recommendation engine with this dataset.


```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```


### Loading required packages

```{r}

library(tidyr)
library(dplyr)
library(reshape2)
library(ggplot2)

```


### Loading the data

```{r}

movies <- read.csv('movie_metadata.csv',stringsAsFactors=FALSE)
glimpse(movies)
summary(movies)

```

The missing values are present in:

num_critic_for_reviews(50)
duration(15)
director_facebbok_likes(104)
actor_3_facebook_likes(23)
actor_1_facebook_likes(7)
gross(884)
facenumber_in_poster(13)
num_user_for_reviews(21)
budget(492)
title_year(108)
actor_2_facebook_likes(13)
aspect_ratio(329)


### Removing the duplcate movies

```{r}

idx_dup <- which(duplicated(movies$movie_title)==TRUE)
movies <- movies[-idx_dup,]


```


### Finding columns and rows with missing values using function
```{r}
miss <- function(x) {
 cat('\nThe columns having missing values are:')
 for(i in 1:ncol(x)) {
  if(length(x[i][is.na(x[i])]) > 0) {
    cat('\n',names(x[i]),':',length(x[i][is.na(x[i])]))
  }
 } 
  cat('\n\nThe number of rows with missing values are:',nrow(x)-nrow(na.omit(x)))
  cat('\nThe proportion of missing values is:',signif((nrow(x)-nrow(na.omit(x)))/nrow(x),2))
}

miss(movies)
```


### Removing rows with missing values in budget and gross
### Missing values in rest of the columns can be replaced with zeros

```{r}

# remove the rows having missing values in budget and gross
idx <- which(is.na(movies$budget)==TRUE)
movies <- movies[-idx,]

idx <- which(is.na(movies$gross)==TRUE)
movies <- movies[-idx,]
 
# replace with zeros
movies[is.na(movies)] <- 0

# checking the missing values
miss(movies)
 

```

Now the dataset is clean and ready


### Write into csv file so as to do visualizations in tableau

```{r}

write.csv(movies,'movies_tab.csv')


```


Can infer the following from plots:

- Majority of the scores are in range of 6-8
- Countries like China, Hong kong, India, Italy, Japan, Mexico, Spain, UK have produced the average score of above 7 (min. count of movies is 10)
- UK produced lots of movies (313) with average Imdb score of 7
- US produced largest number of movies(2993), however their average imdb score is 6.5
- We can find that over the years(spcifically after 1975) the quality of movies(as per score) has come down. This might be partly due to the fact that large number of movies are being made.
- As the "movie facebook likes" increases, the score also increases. There are few outliers too like for instance "Interstellar" got the maximum likes(>350k) but score is only 8.6 where as "Godfather" got less than 50k likes but its score is 9.2
- There is positive relationship between "cast total FB likes" and Imdb score, however its not as strong as that of "movie facebook likes"
- As the duration of movie increases, the score also increases
- Generally speaking as the score of movie increases, the gross also increases. However the budgets for high gross earning movies is also high. For instance, movie like Avator which made whopping gross had gross profit margin of 69% where as Twilight made on comparitively less budget made gross profit margin of 83%
- The most succesful director(with min. 10 movies) with high scores is David Fincher, followed by steven spielberg and Martin Scorsese


### Principal component analysis (PCA)


```{r}

#remove the dependent and identifier variables
my_data <- subset(movies, select = -c(imdb_score,genres,plot_keywords,movie_imdb_link))

#check variable class
str(my_data)

#load library
#install.packages('dummies')
library(dummies)

#create a dummy data frame
new_my_data <- dummy.data.frame(my_data, names = c("color","director_name",
                                "actor_2_name","actor_1_name",
                                "movie_title","actor_3_name",
                                "language","country",
                                "content_rating"))

#divide the new data

idx <- sample(nrow(new_my_data),size=round(nrow(new_my_data)*0.7))

pca.train <- new_my_data[idx,]
pca.test <- new_my_data[-idx,]

#do scaling

pca.train <- scale(pca.train, center = TRUE, scale = TRUE)
pca.test <- scale(pca.test, center = TRUE, scale = TRUE)

#PCA

prin_comp <- prcomp(pca.train,scale. = FALSE)
prin_comp

```



```{r}
biplot(prin_comp,scale=0)

std_dev <- prin_comp$sdev
pr_var <- std_dev^2

prop_var <- pr_var/sum(pr_var)

plot(prop_var,type='b',xlab = 'Number of Principal Components',ylab='Proportion of variance explained')

plot(cumsum(prop_var),type='b',xlab = 'Number of Principal Components',ylab='Cummulative Proportion of variance explained')

summary(prin_comp)

```



