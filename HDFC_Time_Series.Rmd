---
title: "Time-series forecasting of HDFC stock prices"
output: 
  html_document: 
    smart: no
---

### Project details: 


#### Domain: Retail
#### Project: Time-series forecasting of HDFC stock prices
#### Data: NSE-HDFC.csv

#### Description
- Time-series is an ordered sequence of values of a variable at equally spaced time intervals.
- It can be used to obtain an understanding of the underlying forces and structure that produced the observed data. Or to fit a model and proceed to forecasting, monitoring or even feedback and feedforward control.
- We have a daily stock prices data of HDFC from 1998 to 2017.

#### Case questions
- You have to forecast the stock prices for HDFC for the next 3 months. Apart from forecasting the prices, in this time series analysis, try to answer the following fundamental questions using the same dataset:

1. What are the components of a time series?
2. How to create lags of a time series?
3. How to decompose it?
4. How to de-trend, de-seasonalize a time series?

#### Guidelines

- Use techniques like simple moving average, Holtwinters and ARIMA.
- For this time series analysis take only the closing prices (Close) for the day into account.



```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```


### Loading required packages

```{r}

library(forecast)
library(TTR)
library(Metrics)
library(tidyr)
library(dplyr)

```

### Loading the data
### stocks are provided for years 1998 to 2017 (only working days - weekends and holidays are excluded)

```{r}

stocks <- read.csv('NSE-HDFC.csv')
str(stocks)

```

### Creating time series data with input dates

```{r}
library(xts)
stocks <- na.omit(stocks)

stocksxts <- xts(stocks$Close, order.by=as.Date(stocks$Date,  "%d-%m-%Y"))
head(stocksxts)
tail(stocksxts)

```

### Plotting the time series data

```{r}

plot(stocksxts)

```

### Converting the data to monthly for stl

```{r}

stkmon <- to.weekly(stocksxts)
stocksts <- ts(as.vector(stkmon[,4]),start=c(1998,13),end=c(2017,8),frequency = 52)
stocksts

```



### Seasonal trend decompostion


```{r}

seasonaldecom <- stl(stocksts,s.window = "periodic")
seasonaldecom

```

### Plotting the Seasonal trend decompostion

```{r}
plot(seasonaldecom)
monthplot(stocksts)

```

### Initialize the results table

```{r}
results <- NULL
results <- data.frame()

```

### Simple Moving Average 

```{r}

#install.packages('smooth')
library(smooth)

SMAi <- sma(as.ts(stocksxts), h=65,silent="graph")

plot(forecast(SMAi,h=65))

# Accuracy


temp <- list(sqrt(SMAi$cf))
temp <- as.data.frame(temp,col.names = 'RMSE', row.names = 'SMA')

results <- rbind(results,temp)

results['SMA',]



```


Can infer that:

- RMSE for the model is 59.85817


### Single exponential smoothing
### Holt-Winters exponential smoothing without trend and without seasonal component.

```{r}

SES_Auto <- HoltWinters(stocksxts,beta = FALSE,gamma=FALSE)
SES_Auto

SES_Auto_forcast <- forecast(SES_Auto,h=65)

# Accuracy

temp <- list(accuracy(SES_Auto_forcast)[,'RMSE'])
temp <- as.data.frame(temp,col.names = 'RMSE', row.names = 'SES')

results <- rbind(results,temp)

results['SES',]

# Plot the graph

p <- plot(SES_Auto_forcast)
lines(SES_Auto_forcast$fitted,col='green')
axis(1,index(stocksxts),format(index(stocksxts),"%d %b", cex.axis=0.7))
print(p)


```


Can infer that:

- RMSE for the model is 59.86455 



### Double exponential smoothing
### Holt-Winters exponential smoothing with trend and without seasonal component.

```{r}

DES_Auto <- HoltWinters(stocksts,gamma=FALSE)
DES_Auto

DES_Auto_forcast <- forecast(DES_Auto,h=90)

# Accuracy

temp <- list(accuracy(DES_Auto_forcast)[,'RMSE'])
temp <- as.data.frame(temp,col.names = 'RMSE', row.names = 'DES')

results <- rbind(results,temp)

results['DES',]

# Plot the graph

p <- plot(DES_Auto_forcast)
lines(DES_Auto_forcast$fitted,col='green')
print(p)


```

Can infer that:

- RMSE for the model is 60.53214


### Triple exponential smoothing
### Holt-Winters exponential smoothing with trend and additive seasonal component.

```{r}

TES_Auto <- HoltWinters(stocksts1)
TES_Auto

TES_Auto_forcast <- forecast(TES_Auto,h=90)

# Accuracy

temp <- list(accuracy(TES_Auto_forcast)[,'RMSE'])
temp <- as.data.frame(temp,col.names = 'RMSE', row.names = 'TES_Add')

results <- rbind(results,temp)

results['TES_Add',]

# Plot the graph

p <- plot(TES_Auto_forcast)
lines(TES_Auto_forcast$fitted,col='green')
print(p)


```

Can infer that:

- RMSE for the model is 61.84063



### Triple exponential smoothing
### Holt-Winters exponential smoothing with trend and multiplicative seasonal component.

```{r}

TES_Auto_M <- HoltWinters(stocksts1,seasonal = c("multiplicative"))
TES_Auto_M

TES_Auto_forcast_M <- forecast(TES_Auto_M,h=90)

# Accuracy

temp <- list(accuracy(TES_Auto_forcast_M)[,'RMSE'])
temp <- as.data.frame(temp,col.names = 'RMSE', row.names = 'TES_Mul')

results <- rbind(results,temp)

results['TES_Mul',]

# Plot the graph

p <- plot(TES_Auto_forcast_M)
lines(TES_Auto_forcast_M$fitted,col='green')
print(p)


```

Can infer that:

- RMSE for the model is 61.52003


### ARIMA (Auto regressive Integrated Moving Average)


```{r}

ARIMA_model <- auto.arima(stocksts)
summary(ARIMA_model)

ARIMA_model_forcast <- forecast(ARIMA_model,h=68)

# Accuracy

temp <- list(accuracy(ARIMA_model_forcast)[,'RMSE'])
temp <- as.data.frame(temp,col.names = 'RMSE', row.names = 'ARIMA')

results <- rbind(results,temp)

results['ARIMA',]

# Plot the graph

p <- plot(ARIMA_model_forcast)
lines(ARIMA_model_forcast$fitted,col='green')
print(p)


```

Can infer that:

- RMSE for the model is 59.85691



### Comparing the various time series models

```{r}

results

idx <- which(results==min(results))
cat('The model selected as the best one is:',row.names(results)[idx],'\nThe RMSE for the model is:',min(results))

```


### Create file with final prediction values from the best model

```{r}

write.csv(ARIMA_model_forcast$mean,"HDFC_forecast_90days.csv")
ARIMA_model_forcast$mean

```

### Conclusion:

- These are predicted values for next 90 business days
- It is forecasted that closing stock prices will decrease and strategies need to be planned accordingly.

