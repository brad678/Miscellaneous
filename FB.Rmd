---
title: "FB"
output: 
  html_document: 
    smart: no
---
#Exploratory questions:::

1) Loading and cleaning of data (handling missing values)
2) Summary statistics
3) Age analysis(D.O.B)
4)


```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r, message=FALSE, warning=FALSE}
library(tidyr)
library(dplyr)
library(ggplot2)
```


### Loading the dataset and taking glimpse of the data

```{r}
fb <- read.csv('pseudo_facebook.tsv',sep='')
glimpse(fb)
```

### Getting the summary to check the columns that are having missing data

```{r}
summary(fb)
```
#### can find that Gender(175),Tenure(2) are having missing values

This has limited columns so we can easily view and tell, but for huge datasets with many columns, it would be diffucult to see and note it. A better approach is to have a function which can be called multiple times to give the stats. 

### Finding columns and rows with missing values using function
```{r}
miss <- function() {
 cat('\nThe columns having missing values are:')
 for(i in 1:ncol(fb)) {
  if(length(fb[i][is.na(fb[i])]) > 0) {
    cat('\n',names(fb[i]),':',length(fb[i][is.na(fb[i])]))
  }
 } 
  cat('\n\nThe number of rows with missing values are:',nrow(fb)-nrow(na.omit(fb)))
}

miss()
```

### Creating new column age_group
```{r}
breaks <- c(0,12,17,24,34,44,54,64,115)

group1 <- findInterval(fb$age,breaks)

age_group <- factor(group1,levels=c(1:8),labels=c('0-12','13-17','18-24','25-34','35-44','45-54','55-64','65 and older'))

fb <- fb %>% mutate(age_group)

fb %>% select(age,age_group) %>% tail(20)

```
### Find the number of missing values for each group. 

```{r}
fb %>% group_by(age_group) %>% count(gender) %>% filter(is.na(gender))

```

Can find that the missing values for gender are present mostly in 55-64 and 65+ bracket. Also the proportion of males and females in that category is almost similar.

```{r}

f2 <- fb %>% group_by(age_group,gender) %>% summarise(tenure=round(mean(tenure,na.rm=TRUE)),friend_count=round(mean(friend_count)),friendships_initiated=round(mean(friendships_initiated)),likes=round(mean(likes)),likes_received=round(mean(likes_received)),count=n()) %>% filter(!is.na(gender))

f2


```


Can infer that even though male count is greater than female:

- tenure for female is greater than male                     

- friends count for female is greater than male (with exception of 65+ group)

- frienships initiated for female is greater than male (with exception of 65+ group)                                                             

- likes for female is greater than male (we can find substantial difference between male & female)                                                    

- likes received for female is greater than male (we can find substantial difference between male & female)                                         


### Create a new dataframe with missing values and remove missing values from the original dataframe
```{r}

fbm <- fb %>% filter(is.na(gender))

fbm <- mutate(fbm,new=paste(age_group,likes,likes_received,sep='#'))

fb <- na.omit(fb)

```


Since "likes" and "likes received"" is having substantial difference between male (low value) and female(high value). We can use these fields to determine gender for missing values.   

- If individual element(like/like received) is less compared to group(like/like received of male) then we can safely assume its male.

- If individual element(like/like received) is greater compared to group(like/like received of female) then we can safely assume its female. 

- since Tenure is having very low number(2) of missing values, its better to drop those rows.


```{r}
func1 <- function(str1) {
  k <- strsplit(str1,split='#')
  x=k[[1]][1]
  y=k[[1]][2]
  z=k[[1]][3]
  
  temp <- filter(f2,age_group==x)[2,]
  
  if(as.numeric(y) <= temp$likes & as.numeric(z)<=temp$likes_received) {
    return('male')
  } 
  
  temp <- filter(f2,age_group==x)[1,]
  if(as.numeric(y) >= temp$likes & as.numeric(z)>=temp$likes_received) {
    return('female')
  } 
 }
   
#updating new column with gender
fbm$new <- sapply(fbm$new,func1)


#converting new column of type "list" to gender of type "factor"
for(i in 1:nrow(fbm)) {
  if(is.null(fbm$new[[i]])) {
    fbm$gender[i] <- NA
  } 
  else {
    fbm$gender[i] <- as.factor(fbm$new[[i]])
    }
  }

#dropping new column
fbm <- fbm[,-17]

#dropping missing values 
fbm <- na.omit(fbm)

glimpse(fbm)

```


Can find that out of 175 missing values for gender, we are able to determine gender for 139 cases. Dropped rest of the 36 cases as there is no clear consensus


### Now concatenate imputed missing value dataframe to original one

```{r}
fb <- rbind(fb,fbm)

# calling missing value function for sanity checking
miss()

```

Now the data is cleaned and is ready for further analysis

### summary stats

```{r}
summary(fb)

```

### Distribution of Age_group

```{r}

ggplot(fb,aes(age_group))+geom_bar()
#ggplot(fb,aes(x=age_group))+geom_bar(fill='blue')+facet_wrap(~gender)+coord_flip()
```
Can infer that there are many young adults and adults facebook users 

```{r}
length(fb$age[fb$age>90])
fb %>% select(dob_year,age) %>% filter(age>90)
```
-There are many users(4894) above age of 90 which is unlikely. These are outliers in the data.

- This dataset is corresponding to the year 2013 (as for dob_year=1913, age is 100)


### Let's look at the distribution of age to understand further
```{r}

summary(fb$age)
hist(fb$age)

```

### Need to remove the outliers in age so as to avoid bias

```{r}
fb <- fb %>% filter(age<=90)
summary(fb)
hist(fb$age)
```

### 

```{r}
hist(fb$likes)
ggplot(fb,aes(age_group,log2(likes)))+geom_boxplot()
```

