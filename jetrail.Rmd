---
title: "JetRail"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```


```{r}
library(tidyr)
library(dplyr)
library(forecast)
library(TTR)
library(Metrics)
library(dplyr)
library(zoo)
library(ggplot2)
library(readr)
library(xts)
library(smooth)

```


```{r}
train <- read_csv('Train_SU63ISt.csv')

```

```{r}
test <- read_csv("Test_0qrQsBZ.csv")
```

```{r}

time_index <- seq(from = as.POSIXct("2012-08-25 00:00"), to = as.POSIXct("2014-09-25 23:00"), by = "hour")

train_hr <- xts(train$Count, order.by = time_index)

head(train_hr);tail(train_hr);

```

```{r}
plot(train_hr)
```

```{r}

x <- msts(train$Count, seasonal.periods=c(24,24*7,365.25*24), start=2012+34/52)
plot(x)

```

#decomposition
```{r}

stl1 <- stl(x,s.window = "periodic")
plot(stl1)

```

### Simple moving average

```{r}

#SMA
SMA_test <- sma(x, h=nrow(test),silent="graph")

test_op <- data.frame(ID=test$ID,Count=SMA_test$forecast)

colnames(test_op) <- c("ID","Count")
```

```{r}

dir <- "C:\\Users\\Srimala Bharadwaj\\Desktop\\Data science\\AV\\JetRail"
write_csv(test_op, file.path(dir, "sma.csv"), col_names = TRUE)


```


### Simple moving average 1

```{r}

#SMA
SMA_test1 <- sma(x, ic=c("BIC"),h=nrow(test),silent="graph", holdout = TRUE, accuracy="sMSE")

test_op <- data.frame(test$ID, SMA_test1$forecast)

colnames(test_op) <- c("ID","Count")
```

```{r}

dir <- "C:\\Users\\Srimala Bharadwaj\\Desktop\\Data science\\AV\\JetRail"
write_csv(test_op, file.path(dir, "sma1.csv"), col_names = TRUE)


```


### tslm - add

```{r}

#SMA
tslm_add <- tslm(x ~ trend + season)
summary(tslm_add)
#test_op <- data.frame(test$ID, SMA_test1$forecast)

#colnames(test_op) <- c("ID","Count")
```

```{r}


f1 <- forecast(tslm_add,h=nrow(test))
#f1 <- predict(tslm_add,n.ahead=nrow(test))

```

```{r}
test_op <- data.frame(test$ID, f1$mean)

colnames(test_op) <- c("ID","Count")
```


```{r}

dir <- "C:\\Users\\Srimala Bharadwaj\\Desktop\\Data science\\AV\\JetRail"
write_csv(test_op, file.path(dir, "tslm1.csv"), col_names = TRUE)


```



### tslm - add

```{r}

#SMA
tslm_add1 <- tslm(x ~ trend)
summary(tslm_add1)
#test_op <- data.frame(test$ID, SMA_test1$forecast)

#colnames(test_op) <- c("ID","Count")
```

```{r}


f1 <- forecast(tslm_add1,h=nrow(test))
#f1 <- predict(tslm_add,n.ahead=nrow(test))

```

```{r}
test_op <- data.frame(test$ID, f1$mean)

colnames(test_op) <- c("ID","Count")
```


```{r}

dir <- "C:\\Users\\Srimala Bharadwaj\\Desktop\\Data science\\AV\\JetRail"
write_csv(test_op, file.path(dir, "tslm2.csv"), col_names = TRUE)


```


```{r}
#ar1 <- acf(tslm_add$residuals)
#ar1$acf[2]

#library(nlme)

#tslm_gls <- gls(x ~ time(x) ,cor=corAR1(ar1$acf[2]))
tslm_add2 <- tslm(x ~ time(x))
summary(tslm_add2)


```

```{r}


#f1 <- forecast(tslm_add2,h=nrow(test))
f1 <- predict(tslm_add2,n.ahead=nrow(test))

```

```{r}
test_op <- data.frame(test$ID, f1$mean)

colnames(test_op) <- c("ID","Count")
```


```{r}

dir <- "C:\\Users\\Srimala Bharadwaj\\Desktop\\Data science\\AV\\JetRail"
write_csv(test_op, file.path(dir, "tslm3.csv"), col_names = TRUE)


```

#arima
```{r}

arima_1 <- auto.arima(x)
summary(arima_1)

```

```{r}


f1 <- forecast(arima_1,h=nrow(test))
#f1 <- predict(tslm_add2,n.ahead=nrow(test))

```

```{r}
test_op <- data.frame(test$ID, f1$mean)

colnames(test_op) <- c("ID","Count")
```


```{r}

dir <- "C:\\Users\\Srimala Bharadwaj\\Desktop\\Data science\\AV\\JetRail"
write_csv(test_op, file.path(dir, "arima1.csv"), col_names = TRUE)


```

#tbats
```{r}

tbats_1 <- tbats(x)
summary(tbats)

```

```{r}


f1 <- forecast(arima_1,h=nrow(test))
#f1 <- predict(tslm_add2,n.ahead=nrow(test))

```

```{r}
test_op <- data.frame(test$ID, f1$mean)

colnames(test_op) <- c("ID","Count")
```


```{r}

dir <- "C:\\Users\\Srimala Bharadwaj\\Desktop\\Data science\\AV\\JetRail"
write_csv(test_op, file.path(dir, "arima1.csv"), col_names = TRUE)


```


```{r}

train1_hr <- to.hourly(train_hr)
train2_hr <- ts(as.vector(train1_hr[,4]),start=c(2012,08,25),end=c(2014,09,25),frequency = 24)
train2_hr

```





